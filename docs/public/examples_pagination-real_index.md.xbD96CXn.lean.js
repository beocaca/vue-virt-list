import{p as ls,a as x,b as $,O as us}from"./chunks/ObserverItem.6qwwCos6.js";import{d as X,a6 as b,h as y,a7 as hs,y as fs,a8 as Bs,C as Ds,j as Es,a9 as As,o as K,c as P,k as o,t as q,_ as vs,I as j,a5 as ms,w as M,m as Ss,P as ks,D as _s,R as rs}from"./chunks/framework.lQqlyL6x.js";import{a as V}from"./chunks/common.ag3T3Vnt.js";const zs={itemKey:"id",miniSize:40,list:[],scrollDistance:100,headerClass:"",headerStyle:"",footerClass:"",footerStyle:"",stickyHeaderClass:"",stickyHeaderStyle:"",stickyFooterClass:"",stickyFooterStyle:""},Ts=(f,i)=>{const s=new Proxy(f,{get(a,t){return Reflect.get(a,t)??Reflect.get(zs,t)}}),h=y(null),c=y(null),D=y(null),A=y(null),v=y(null),g=y(null),F=new Map,B=new Map,l=hs({clientSize:0,headerSize:0,footerSize:0,stickyHeaderSize:0,stickyFooterSize:0}),r=hs({listTotalSize:0,begin:"",end:""}),z=y(!1),T=y(!1),R=y(!1),G=()=>{var k;const{itemKey:a}=s;let t=0;for(let E=0;E<=s.list.length-1;E+=1)t+=w((k=s.list[E])==null?void 0:k[a]);r.listTotalSize=t},w=a=>F.get(String(a))??s.minSize,U=(a,t)=>{F.set(String(a),t)},m=()=>h.value?h.value.scrollTop:0;let n;typeof ResizeObserver<"u"&&(n=new ResizeObserver(a=>{var E;let t=0;for(const e of a){const{id:p}=e.target.dataset;if(p){const _=w(p),d=e.contentBoxSize[0].blockSize;p==="client"?l.clientSize=d:p==="header"?l.headerSize=d:p==="footer"?l.footerSize=d:p==="stickyHeader"?l.stickyHeaderSize=d:p==="stickyFooter"?l.stickyFooterSize=d:_!==d&&(U(p,d),t+=d-_,(E=i==null?void 0:i.itemResize)==null||E.call(i,p,d))}}if(r.listTotalSize+=t,G(),L(),R.value){z.value&&as("forward"),T.value&&as("backward");return}const k=m();Z(k)}));const C=a=>B.get(String(a))??-1,H=(a,t)=>{B.set(String(a),t)},L=()=>{var k,E;const{itemKey:a}=s;B.clear();let t=0;for(let e=0;e<s.list.length;e+=1)H((k=s.list[e])==null?void 0:k[a],t),t+=w((E=s.list[e])==null?void 0:E[a])},I=()=>l.headerSize+l.stickyFooterSize+l.stickyHeaderSize,ds=(a,t)=>{let k;return function(){clearTimeout(k),k=setTimeout(()=>a(),t)}};let Y="";const gs=ds(()=>{var a;Y=is(),(a=i==null?void 0:i.updateCurrent)==null||a.call(i,Y)},200),Z=a=>{var t,k;s.list.length<=0||(a<=s.scrollDistance&&(r.begin=s.list[0][s.itemKey],s.list.length>s.pageSize?r.end=s.list[s.list.length-s.pageSize-1][s.itemKey]:r.end=s.list[s.list.length-1][s.itemKey],(t=i==null?void 0:i.toTop)==null||t.call(i,s.list[0]),T.value=!1,z.value=!0),a+s.scrollDistance>=r.listTotalSize+I()-l.clientSize&&(r.end=s.list[s.list.length-1][s.itemKey],s.list.length>s.pageSize?r.begin=s.list[s.pageSize][s.itemKey]:r.begin=s.list[0][s.itemKey],(k=i==null?void 0:i.toBottom)==null||k.call(i,s.list[s.list.length-1]),T.value=!0,z.value=!1))},ss=a=>{var k;if((k=i==null?void 0:i.scroll)==null||k.call(i,a),s.list.length<=0)return;const t=m();if(R.value){const E=C(r.begin);t<E&&S(E);return}gs(),Z(t)},S=a=>{const t="scrollTop";h.value&&(h.value[t]=a)},ys=a=>{var E;const t=C((E=s.list[a])==null?void 0:E[s.itemKey]),k=async(e,p)=>{var ns;if(e===-1){setTimeout(()=>{var ts;const Cs=C((ts=s.list[a])==null?void 0:ts[s.itemKey]);k(Cs,p)},3);return}const _=w((ns=s.list[a])==null?void 0:ns[s.itemKey]),d=e+_,J=m(),Q=m()+l.clientSize;if(e<J&&J<d&&_<l.clientSize){S(e+l.headerSize),p();return}if(e+l.stickyHeaderSize<Q&&Q<d+l.stickyHeaderSize&&_<l.clientSize){S(d-l.clientSize+l.stickyHeaderSize),p();return}if(e+l.stickyHeaderSize>=Q){await O(a),p();return}d<=J&&await O(a),p()};return new Promise(e=>{k(t,e)})},os=a=>{var k;const t=(k=s.list[a])==null?void 0:k[s.itemKey];return C(t)},is=()=>{let a="";const t=m(),k=t+l.stickyHeaderSize-l.headerSize,E=k<0?0:k;for(const[e,p]of B)if(p<=E&&p+w(e)>t){a=e;break}return a},O=a=>{var E;if(a<0)return;if(a>=s.list.length-1){cs();return}const t=C((E=s.list[a])==null?void 0:E[s.itemKey]),k=(e,p)=>{if(e===-1){setTimeout(()=>{var d;const _=C((d=s.list[a])==null?void 0:d[s.itemKey]);k(_,p)},3);return}S(e+l.headerSize),p()};return new Promise(e=>{k(t,e)})},cs=()=>{const a=r.listTotalSize+l.headerSize+l.footerSize;S(a)};let N=0;const as=a=>{h.value&&S(a==="forward"?N+C(r.begin):N)},Fs=()=>{r.listTotalSize=0,r.begin="",r.end="",F.clear(),B.clear()};return fs(()=>s.list,()=>{R.value=!0},{deep:!1}),Bs(()=>{z.value&&(N=m()),T.value&&(N=m()-B.get(String(r.begin)))}),Ds(()=>{setTimeout(()=>{R.value=!1},10)}),Es(()=>{h.value&&(h.value.addEventListener("scroll",ss),n==null||n.observe(h.value)),v.value&&(n==null||n.observe(v.value)),g.value&&(n==null||n.observe(g.value)),D.value&&(n==null||n.observe(D.value)),A.value&&(n==null||n.observe(A.value))}),As(()=>{h.value&&(h.value.removeEventListener("scroll",ss),n==null||n.unobserve(h.value),l.clientSize=0),v.value&&(n==null||n.unobserve(v.value),l.stickyHeaderSize=0),g.value&&(n==null||n.unobserve(g.value),l.stickyFooterSize=0),D.value&&(n==null||n.unobserve(D.value),l.headerSize=0),A.value&&(n==null||n.unobserve(A.value),l.footerSize=0)}),{props:s,resizeObserver:n,sizesMap:F,slotSize:l,clientRefEl:h,listRefEl:c,headerRefEl:D,footerRefEl:A,stickyHeaderRefEl:v,stickyFooterRefEl:g,scrollIntoView:ys,scrollToIndex:O,reset:Fs,getItemOffset:C,getCurrentFirstItem:is,getOffsetByIndex:os,scrollToOffset:S}},ws=X({name:"RealList",props:{itemKey:{type:[String,Number],default:"id"},list:{type:Array,default:()=>[]},minSize:{type:Number,default:40},pageSize:{type:Number,default:30},scrollDistance:{type:Number,default:100},headerClass:{type:String,default:""},headerStyle:{type:String,default:""},footerClass:{type:String,default:""},footerStyle:{type:String,default:""},stickyHeaderClass:{type:String,default:""},stickyHeaderStyle:{type:String,default:""},stickyFooterClass:{type:String,default:""},stickyFooterStyle:{type:String,default:""}},setup(f,i){return Ts(f,{scroll:h=>{i.emit("scroll",h)},toTop:h=>{i.emit("toTop",h)},toBottom:h=>{i.emit("toBottom",h)},itemResize:(h,c)=>{i.emit("itemResize",h,c)},updateCurrent:h=>{i.emit("updateCurrent",h)}})},render(){const{props:f,resizeObserver:i}=this,{itemKey:s,headerClass:h,headerStyle:c,footerClass:D,footerStyle:A,stickyHeaderClass:v,stickyHeaderStyle:g,stickyFooterClass:F,stickyFooterStyle:B}=f,{header:l,footer:r,stickyHeader:z,stickyFooter:T}=this.$slots,R=()=>z?b("div",x({key:"slot-sticky-header",class:v,style:`position: sticky; z-index: 10; 'top: 0; ${g}`,ref:"stickyHeaderRefEl"},{"data-id":"stickyHeader"}),[$(z)]):null,G=()=>T?b("div",x({key:"slot-sticky-footer",class:F,style:`position: sticky; z-index: 10; bottom: 0; ${B}`,ref:"stickyFooterRefEl"},{"data-id":"stickyFooter"}),[$(T)]):null,w=()=>l?b("div",x({key:"slot-header",class:h,style:c,ref:"headerRefEl"},{"data-id":"header"}),[$(l)]):null,U=()=>r?b("div",x({key:"slot-footer",class:D,style:A,ref:"footerRefEl"},{"data-id":"footer"}),[$(r)]):null,m=()=>{var C,H;const n=[];for(let L=0;L<f.list.length;L++){const I=f.list[L];n.push(b(us,x({key:I[s]},{id:I[s],resizeObserver:i}),ls([(H=(C=this.$slots).default)==null?void 0:H.call(C,{itemData:I})])))}return b("div",{ref:"listRefEl"},[n])};return b("div",x({ref:"clientRefEl",style:"width: 100%; height: 100%; overflow: overlay;"},{"data-id":"client"}),ls([R(),w(),m(),U(),G()]))}}),bs={class:"row-item"},qs={class:"row-message"},Rs=X({__name:"Item",props:{itemData:{}},setup(f){return(i,s)=>(K(),P("div",bs,[o("div",qs,q(i.itemData.index)+" - "+q(i.itemData.id)+" - "+q(i.itemData.text),1)]))}}),xs=vs(Rs,[["__scopeId","data-v-9506c4c3"]]),Ls={class:"demo-table",style:{display:"flex","flex-direction":"column","align-items":"center"}},Is={style:{padding:"10px 0"}},Ks=o("span",null,"   ",-1),Ps=o("span",null,"   ",-1),Hs=o("span",null,"   ",-1),Ns=o("span",null,"   ",-1),$s={class:"demo"},Vs=o("div",{style:{width:"100%",height:"20px",display:"flex","justify-content":"center","align-items":"center","background-color":"chocolate"}}," 加载中... ",-1),Ms={style:{width:"100%",height:"20px",display:"flex","justify-content":"center","align-items":"center","background-color":"chocolate"}},js={key:0},Gs={key:1},es=10,W=1,u=40,ps="id",Us=X({__name:"Main",setup(f){const i=y([]),s=y(1),h=y(""),c=y(!1),D=async()=>{if(console.log("onTop"),c.value||s.value<=1)return;c.value=!0;const F=(await V(u,(s.value-2)*u,1e3)).concat(i.value.slice(0,u));i.value=F,ks(()=>{s.value-=1,c.value=!1})},A=async()=>{if(console.log("onToBottom"),c.value)return;if(s.value+W>=es){console.warn("已到最大页码",s.value);return}c.value=!0,s.value+=1;const g=await V(u,(s.value-1)*u,1e3);i.value.splice(0,u),i.value=i.value.concat(g),ks(()=>{c.value=!1})},v=g=>{h.value=g};return Es(async()=>{const g=await V(u,(s.value-1)*u),F=await V(u,s.value*u);i.value=g.concat(F),h.value=i.value[0][ps]}),(g,F)=>(K(),P("div",Ls,[o("div",Is,[o("span",null,"Total: "+q(i.value.length),1),Ks,o("span",null,"First Item In View: "+q(h.value),1),Ps,o("span",null,"currentBeginPage: "+q(s.value),1),Hs,o("span",null,"currentEndPage: "+q(s.value+W),1),Ns]),o("div",$s,[j(Ss(ws),{ref:"realListRef",minSize:44,list:i.value,pageSize:u,onToTop:D,onToBottom:A,onUpdateCurrent:v,itemKey:ps,listStyle:"width: 1500px;"},ms({default:M(({itemData:B})=>[j(xs,{itemData:B},null,8,["itemData"])]),footer:M(()=>[o("div",Ms,[s.value+W<=es-1?(K(),P("div",js,"加载中...")):(K(),P("div",Gs,"到底了...."))])]),_:2},[s.value>1?{name:"header",fn:M(()=>[Vs]),key:"0"}:void 0]),1032,["list"])])]))}}),Os=rs("",4),Js=rs("",1),Zs=JSON.parse('{"title":"分页-真实列表 RealList","description":"","frontmatter":{},"headers":[],"relativePath":"examples/pagination-real/index.md","filePath":"examples/pagination-real/index.md"}'),Qs={name:"examples/pagination-real/index.md"},si=Object.assign(Qs,{setup(f){return(i,s)=>{const h=_s("ClientOnly");return K(),P("div",null,[Os,j(h,null,{default:M(()=>[j(Us)]),_:1}),Js])}}});export{Zs as __pageData,si as default};
